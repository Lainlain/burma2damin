import{b as u,e as J,j as Ve,l as be,_ as B,A as l,V as g,Y as a,X as n,Z as o,F as oe,$ as ue,G as f,U as p,a4 as se,a3 as U}from"./vue-vendor-UqzHlSlI.js";import{c,a as _,e as M,d as P,V as ie,b as ne,f as S}from"./VCard-Dx7sTbne.js";import{V as K,a as Ce}from"./VTextField-_cR0O_Sp.js";import{a as v,b as R,i as m,j as de,k as Q}from"./index-BIT7kh2I.js";import{V as W}from"./VAlert-BmWryl3g.js";import{V as we}from"./VForm-alRvmnZJ.js";import{V as pe}from"./VSelectionControl-DUBgrwJs.js";import{V as Ue}from"./VSelect-DlhRwvkk.js";import"./vuetify-e3zVlVid.js";import"./axios-R-lXtGyY.js";import"./VChip-CGXf3eV_.js";const Pe={class:"text-h6 mb-2"},Te={class:"text-caption"},xe={key:1,class:"mt-4"},Ie={class:"text-subtitle-1 mb-2"},$e={class:"text-caption mt-2"},Fe={key:0},Oe={__name:"PaperManagement",setup(De){const h=u(!1),L=u([]),b=u([]),i=u(null),$=u(!1),j=u(!1),y=u({type_id:null,type_name:""}),z=u(!1),k=u(null),q=u(""),T=u(!1),O=u(0),G=u(!1),d=u([]),C=u(!1),F=u(0),D=u(0),A=u(0),E=u(0),x=u(0),N=u(!1),X=u(""),w=u({type_id:null}),Y=J(()=>i.value?L.value.filter(r=>r.type_id===i.value):[]),ee=J(()=>{const r=b.value.find(e=>e.type_id===i.value);return r?r.type_name:""}),le=J(()=>D.value===0?0:F.value/D.value*100),ae=r=>{const e=b.value.find(t=>t.type_id===r);return e?e.image_count:0},Z=async()=>{try{const r=await _.get("/api/burma2d/papers/types");b.value=r.data,b.value.length>0&&!i.value&&(i.value=b.value[0].type_id)}catch(r){console.error("Error fetching paper types:",r)}},H=(r=null)=>{r?(j.value=!0,y.value={...r}):(j.value=!1,y.value={type_id:null,type_name:""}),$.value=!0},me=async()=>{var r,e;try{if(!y.value.type_name||y.value.type_name.trim()===""){alert("Please enter a type name");return}j.value?await _.put(`/api/admin/paper/types/${y.value.type_id}`,{name:y.value.type_name,display_order:0,is_active:!0}):await _.post("/api/admin/paper/types",{name:y.value.type_name,display_order:0}),$.value=!1,await Z()}catch(t){console.error("Error saving paper type:",t),alert("Error: "+(((e=(r=t.response)==null?void 0:r.data)==null?void 0:e.error)||t.message))}},ve=async r=>{var t,s;const e=ae(r.type_id);if(e>0){alert(`Cannot delete type "${r.type_name}" because it has ${e} images. Please delete the images first.`);return}if(confirm(`Are you sure you want to delete type "${r.type_name}"?`))try{await _.delete(`/api/admin/paper/types/${r.type_id}`),i.value===r.type_id&&(i.value=null),await Z()}catch(V){console.error("Error deleting paper type:",V),alert("Error: "+(((s=(t=V.response)==null?void 0:t.data)==null?void 0:s.error)||V.message))}},I=async()=>{if(!i.value){L.value=[];return}h.value=!0;try{const r=await _.get(`/api/burma2d/papers/types/${i.value}/images`);L.value=r.data.map(e=>({...e,type_id:i.value,type_name:ee.value}))}catch(r){console.error("Error fetching papers:",r),L.value=[]}finally{h.value=!1}},fe=()=>{if(k.value){const r=new FileReader;r.onload=e=>{q.value=e.target.result},r.readAsDataURL(k.value)}},te=async(r,e)=>{const t=new FormData;t.append("image",r);try{const s=await _.post("/api/admin/upload-image",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e});return console.log("Upload response:",s.data),s.data.image_url}catch(s){throw console.error("Error uploading image:",s),s}},ye=async()=>{var r,e;try{if(!k.value){alert("Please select an image to upload");return}if(!i.value){alert("Please select a paper type first");return}T.value=!0;const t=await te(k.value,s=>{O.value=s.loaded/s.total*100});t&&await _.post("/api/admin/paper/images",{type_id:i.value,image_url:t,display_order:0}),z.value=!1,k.value=null,q.value="",await I()}catch(t){console.error("Error saving paper:",t),alert("Error: "+(((e=(r=t.response)==null?void 0:r.data)==null?void 0:e.error)||t.message))}finally{T.value=!1,O.value=0}},ge=async r=>{if(confirm("Are you sure you want to delete this paper image?"))try{await _.delete(`/api/admin/paper/images/${r.image_id}`),await I()}catch(e){console.error("Error deleting paper:",e)}},ce=()=>{d.value=[],F.value=0,D.value=0,A.value=0,E.value=0,x.value=0,N.value=!1,w.value={type_id:i.value},G.value=!0},_e=()=>{C.value||(G.value=!1,N.value&&E.value>0&&I())},ke=async()=>{var r;if(!d.value||d.value.length===0){alert("Please select images to upload");return}if(!w.value.type_id){alert("Please select a paper type");return}C.value=!0,D.value=d.value.length,F.value=0,E.value=0,x.value=0,N.value=!1;for(let e=0;e<d.value.length;e++){const t=d.value[e];X.value=t.name;try{const s=await te(t,V=>{A.value=V.loaded/V.total*100});if(console.log("Uploaded URL:",s),console.log("Type ID:",w.value.type_id),s){const V=await _.post("/api/admin/paper/images",{type_id:w.value.type_id,image_url:s,display_order:0});console.log("Create response:",V),E.value++}else console.error("No uploaded URL returned"),x.value++}catch(s){console.error(`Error uploading ${t.name}:`,s),console.error("Error details:",(r=s.response)==null?void 0:r.data),x.value++}F.value++,A.value=0}C.value=!1,N.value=!0,X.value="",await I()};let re=!0;return Ve(i,async r=>{r&&!re&&await I()}),be(async()=>{await Z(),await I(),re=!1}),(r,e)=>(n(),B("div",null,[l(c,{class:"mb-4"},{default:a(()=>[l(M,{class:"d-flex align-center"},{default:a(()=>[l(v,{class:"mr-2"},{default:a(()=>[...e[11]||(e[11]=[o("mdi-folder-multiple",-1)])]),_:1}),e[14]||(e[14]=o(" Paper Types ",-1)),l(R),l(m,{color:"primary",onClick:e[0]||(e[0]=t=>H())},{default:a(()=>[l(v,{left:""},{default:a(()=>[...e[12]||(e[12]=[o("mdi-plus",-1)])]),_:1}),e[13]||(e[13]=o(" Add Type ",-1))]),_:1})]),_:1}),l(P,null,{default:a(()=>[l(ie,null,{default:a(()=>[(n(!0),B(oe,null,ue(b.value,t=>(n(),g(ne,{key:t.type_id,cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[l(c,{color:i.value===t.type_id?"primary":"",variant:i.value===t.type_id?"tonal":"elevated",onClick:s=>i.value=t.type_id,style:{cursor:"pointer"}},{default:a(()=>[l(P,{class:"text-center"},{default:a(()=>[f("div",Pe,p(t.type_name),1),f("div",Te,p(ae(t.type_id))+" images ",1)]),_:2},1024),l(S,{class:"justify-center"},{default:a(()=>[l(m,{icon:"",size:"small",color:"primary",onClick:se(s=>H(t),["stop"])},{default:a(()=>[l(v,null,{default:a(()=>[...e[15]||(e[15]=[o("mdi-pencil",-1)])]),_:1})]),_:1},8,["onClick"]),l(m,{icon:"",size:"small",color:"error",onClick:se(s=>ve(t),["stop"])},{default:a(()=>[l(v,null,{default:a(()=>[...e[16]||(e[16]=[o("mdi-delete",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["color","variant","onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),i.value?(n(),g(c,{key:0},{default:a(()=>[l(M,{class:"d-flex align-center"},{default:a(()=>[l(v,{class:"mr-2"},{default:a(()=>[...e[17]||(e[17]=[o("mdi-newspaper",-1)])]),_:1}),o(" "+p(ee.value)+" Images ",1),l(R),l(m,{color:"secondary",onClick:ce,class:"mr-2"},{default:a(()=>[l(v,{left:""},{default:a(()=>[...e[18]||(e[18]=[o("mdi-cloud-upload",-1)])]),_:1}),e[19]||(e[19]=o(" Bulk Upload ",-1))]),_:1}),l(m,{color:"error",onClick:r.removeAllImagesFromType,disabled:Y.value.length===0},{default:a(()=>[l(v,{left:""},{default:a(()=>[...e[20]||(e[20]=[o("mdi-delete-sweep",-1)])]),_:1}),e[21]||(e[21]=o(" Remove All Image ",-1))]),_:1},8,["onClick","disabled"]),e[22]||(e[22]=o(" // Remove all images from selected type (but only delete one image) const removeAllImagesFromType = async () => { if (!selectedType.value) return const images = papers.value.filter(p => p.type_id === selectedType.value) if (images.length === 0) { alert('No images to remove in this category.') return } if (confirm('Are you sure you want to remove all images from this category? (Only one image will be deleted)')) { // Only delete the first image in the list await deletePaper(images[0]) } } ",-1))]),_:1}),l(P,null,{default:a(()=>[l(ie,null,{default:a(()=>[(n(!0),B(oe,null,ue(Y.value,t=>(n(),g(ne,{key:t.image_id,cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[l(c,null,{default:a(()=>[l(de,{src:t.image_url,height:"250",cover:""},null,8,["src"]),l(S,{class:"justify-center"},{default:a(()=>[l(m,{color:"error",variant:"text",onClick:s=>ge(t),block:""},{default:a(()=>[l(v,{left:""},{default:a(()=>[...e[23]||(e[23]=[o("mdi-delete",-1)])]),_:1}),e[24]||(e[24]=o(" Delete ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),Y.value.length===0?(n(),g(W,{key:0,type:"info",class:"mt-4"},{default:a(()=>[...e[25]||(e[25]=[o(' No images in this type yet. Click "Add Image" or "Bulk Upload" to add images. ',-1)])]),_:1})):U("",!0)]),_:1})]),_:1})):(n(),g(c,{key:1},{default:a(()=>[l(P,{class:"text-center py-8"},{default:a(()=>[l(v,{size:"64",color:"grey"},{default:a(()=>[...e[26]||(e[26]=[o("mdi-folder-open-outline",-1)])]),_:1}),e[29]||(e[29]=f("div",{class:"text-h6 mt-4 mb-2"},"No Paper Types",-1)),e[30]||(e[30]=f("div",{class:"text-body-2 text-grey mb-4"},"Create a paper type to start adding images",-1)),l(m,{color:"primary",onClick:e[1]||(e[1]=t=>H())},{default:a(()=>[l(v,{left:""},{default:a(()=>[...e[27]||(e[27]=[o("mdi-plus",-1)])]),_:1}),e[28]||(e[28]=o(" Create First Type ",-1))]),_:1})]),_:1})]),_:1})),l(K,{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=t=>$.value=t),"max-width":"500px"},{default:a(()=>[l(c,null,{default:a(()=>[l(M,null,{default:a(()=>[o(p(j.value?"Edit Paper Type":"Create Paper Type"),1)]),_:1}),l(P,null,{default:a(()=>[l(Ce,{modelValue:y.value.type_name,"onUpdate:modelValue":e[2]||(e[2]=t=>y.value.type_name=t),label:"Type Name",placeholder:"e.g., Morning News, Evening News",required:""},null,8,["modelValue"])]),_:1}),l(S,null,{default:a(()=>[l(R),l(m,{onClick:e[3]||(e[3]=t=>$.value=!1)},{default:a(()=>[...e[31]||(e[31]=[o("Cancel",-1)])]),_:1}),l(m,{color:"primary",onClick:me},{default:a(()=>[...e[32]||(e[32]=[o("Save",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(K,{modelValue:z.value,"onUpdate:modelValue":e[7]||(e[7]=t=>z.value=t),"max-width":"600px"},{default:a(()=>[l(c,null,{default:a(()=>[l(M,null,{default:a(()=>[...e[33]||(e[33]=[o(" Add Paper Image ",-1)])]),_:1}),l(P,null,{default:a(()=>[l(we,{ref:"form"},{default:a(()=>[l(pe,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=t=>k.value=t),label:"Upload Paper Image",accept:"image/*","prepend-icon":"mdi-camera",onChange:fe,disabled:T.value,required:""},null,8,["modelValue","disabled"]),q.value?(n(),g(c,{key:0,class:"mb-4"},{default:a(()=>[l(de,{src:q.value,"max-height":"200",contain:""},null,8,["src"])]),_:1})):U("",!0),T.value?(n(),g(Q,{key:1,"model-value":O.value,color:"primary",height:"25",striped:""},{default:a(()=>[f("strong",null,p(Math.ceil(O.value))+"%",1)]),_:1},8,["model-value"])):U("",!0)]),_:1},512)]),_:1}),l(S,null,{default:a(()=>[l(R),l(m,{onClick:e[6]||(e[6]=t=>z.value=!1),disabled:T.value},{default:a(()=>[...e[34]||(e[34]=[o("Cancel",-1)])]),_:1},8,["disabled"]),l(m,{color:"primary",onClick:ye,loading:T.value,disabled:!k.value},{default:a(()=>[...e[35]||(e[35]=[o("Upload",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(K,{modelValue:G.value,"onUpdate:modelValue":e[10]||(e[10]=t=>G.value=t),"max-width":"800px"},{default:a(()=>[l(c,null,{default:a(()=>[l(M,null,{default:a(()=>[l(v,{class:"mr-2"},{default:a(()=>[...e[36]||(e[36]=[o("mdi-cloud-upload",-1)])]),_:1}),e[37]||(e[37]=o(" Bulk Upload Papers ",-1))]),_:1}),l(P,null,{default:a(()=>[l(Ue,{modelValue:w.value.type_id,"onUpdate:modelValue":e[8]||(e[8]=t=>w.value.type_id=t),items:b.value,"item-title":"type_name","item-value":"type_id",label:"Select Paper Type",required:"",class:"mb-4"},null,8,["modelValue","items"]),l(pe,{modelValue:d.value,"onUpdate:modelValue":e[9]||(e[9]=t=>d.value=t),label:"Select Multiple Images",accept:"image/*",multiple:"","prepend-icon":"mdi-image-multiple",disabled:C.value,chips:"",counter:"","show-size":""},null,8,["modelValue","disabled"]),d.value&&d.value.length>0?(n(),g(W,{key:0,type:"info",class:"mt-4"},{default:a(()=>[o(p(d.value.length)+" images selected ",1)]),_:1})):U("",!0),C.value?(n(),B("div",xe,[f("div",Ie," Uploading: "+p(F.value)+" / "+p(D.value),1),l(Q,{"model-value":le.value,color:"primary",height:"25",striped:""},{default:a(()=>[f("strong",null,p(Math.ceil(le.value))+"%",1)]),_:1},8,["model-value"]),f("div",$e," Current file: "+p(X.value),1),l(Q,{"model-value":A.value,color:"secondary",height:"15",class:"mt-1"},{default:a(()=>[f("small",null,p(Math.ceil(A.value))+"%",1)]),_:1},8,["model-value"])])):U("",!0),N.value?(n(),g(W,{key:2,type:"success",class:"mt-4"},{default:a(()=>[o(" ✅ Successfully uploaded "+p(E.value)+" images! ",1),x.value>0?(n(),B("span",Fe,[e[38]||(e[38]=f("br",null,null,-1)),o("❌ Failed: "+p(x.value)+" images ",1)])):U("",!0)]),_:1})):U("",!0)]),_:1}),l(S,null,{default:a(()=>[l(R),l(m,{onClick:_e,disabled:C.value},{default:a(()=>[...e[39]||(e[39]=[o("Cancel",-1)])]),_:1},8,["disabled"]),l(m,{color:"primary",onClick:ke,loading:C.value,disabled:!d.value||d.value.length===0||!w.value.type_id},{default:a(()=>[...e[40]||(e[40]=[o(" Upload All ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Oe as default};
