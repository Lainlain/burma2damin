import{c as V,a as y,e as G,d as b,V as Y,b as Z,f as D,g as te}from"./VCard-Dx7sTbne.js";import{V as H,a as A}from"./VTextField-_cR0O_Sp.js";import{a as g,b as q,i as f,j as J,k as re}from"./index-BIT7kh2I.js";import{V as oe,a as ue,b as ie}from"./VTextarea-dPgAWItu.js";import{V as N}from"./VChip-CGXf3eV_.js";import{V as se}from"./VForm-alRvmnZJ.js";import{V as ne}from"./VSelectionControl-DUBgrwJs.js";import{V as de}from"./VSelect-DlhRwvkk.js";import{V as me}from"./VSwitch-DP3MYShV.js";import{b as i,e as fe,l as pe,_ as S,A as a,Y as t,X as p,Z as o,F as P,$ as z,V as w,G as R,U as s,a3 as j}from"./vue-vendor-UqzHlSlI.js";import"./vuetify-e3zVlVid.js";import"./axios-R-lXtGyY.js";const ve={class:"text-h6 mb-2"},ye={class:"text-caption text-grey"},Ee={__name:"GiftManagement",setup(ge){const L=i(!1),C=i([]),n=i([]),d=i(""),k=i(!1),U=i(!1),_=i({type_id:null,type_name:""}),T=i(!1),$=i(!1),v=i(null),x=i(""),c=i(!1),E=i(0),u=i({gift_name:"",image_url:"",reward_type:"",gift_description:"",required_points:0,available_stock:0,is_available:!0}),K=fe(()=>C.value.filter(r=>r.reward_type===d.value)),F=r=>C.value.filter(e=>e.reward_type===r).length,B=async()=>{L.value=!0;try{const r=await y.get("/api/burma2d/gifts");C.value=Object.values(r.data).flat()}catch(r){console.error("Error fetching gifts:",r)}finally{L.value=!1}},I=async()=>{try{const r=await y.get("/api/admin/gift-types");if(r.data&&Array.isArray(r.data)&&r.data.length>0)n.value=r.data,n.value.length>0&&!d.value&&(d.value=n.value[0].type_name);else{const e=[...new Set(C.value.map(l=>l.reward_type))].filter(Boolean);n.value=e.map((l,m)=>({type_id:m+1,type_name:l})),n.value.length>0&&!d.value&&(d.value=n.value[0].type_name)}}catch(r){console.error("Error fetching gift types:",r);const e=[...new Set(C.value.map(l=>l.reward_type))].filter(Boolean);n.value=e.map((l,m)=>({type_id:m+1,type_name:l})),n.value.length>0&&!d.value&&(d.value=n.value[0].type_name)}},O=(r=null)=>{r?(U.value=!0,_.value={...r}):(U.value=!1,_.value={type_id:null,type_name:""}),k.value=!0},Q=async()=>{var r,e;try{U.value?await y.put(`/api/admin/gift-types/${_.value.type_id}`,_.value):await y.post("/api/admin/gift-types",_.value),k.value=!1,await I()}catch(l){console.error("Error saving gift type:",l),alert("Error: "+(((e=(r=l.response)==null?void 0:r.data)==null?void 0:e.error)||l.message))}},W=async r=>{var l,m;const e=F(r.type_name);if(e>0){alert(`Cannot delete type "${r.type_name}" because it has ${e} gifts. Please delete or reassign the gifts first.`);return}if(confirm(`Are you sure you want to delete type "${r.type_name}"?`))try{await y.delete(`/api/admin/gift-types/${r.type_id}`),await I()}catch(M){console.error("Error deleting gift type:",M),alert("Error: "+(((m=(l=M.response)==null?void 0:l.data)==null?void 0:m.error)||M.message))}},h=()=>{if(v.value){const r=new FileReader;r.onload=e=>{x.value=e.target.result},r.readAsDataURL(v.value)}},ee=async()=>{if(!v.value)return null;const r=new FormData;r.append("image",v.value);try{return c.value=!0,(await y.post("/api/admin/upload-image",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:l=>{E.value=l.loaded/l.total*100}})).data.image_url}catch(e){throw console.error("Error uploading image:",e),e}finally{c.value=!1,E.value=0}},X=(r=null)=>{r?($.value=!0,v.value=null,x.value=r.image_url,u.value={...r}):($.value=!1,v.value=null,x.value="",u.value={gift_name:"",image_url:"",reward_type:d.value,gift_description:"",required_points:0,available_stock:0,is_available:!0}),T.value=!0},le=async()=>{var r,e;try{if(v.value){const l=await ee();l&&(u.value.image_url=l)}$.value?await y.put(`/api/admin/gifts/${u.value.gift_id}`,u.value):await y.post("/api/admin/gifts",u.value),T.value=!1,await B()}catch(l){console.error("Error saving gift:",l),alert("Error: "+(((e=(r=l.response)==null?void 0:r.data)==null?void 0:e.error)||l.message))}},ae=async r=>{if(confirm("Are you sure you want to delete this gift?"))try{await y.delete(`/api/admin/gifts/${r.gift_id}`),B()}catch(e){console.error("Error deleting gift:",e)}};return pe(async()=>{await B(),await I()}),(r,e)=>(p(),S("div",null,[a(V,{class:"mb-4"},{default:t(()=>[a(G,{class:"d-flex align-center"},{default:t(()=>[a(g,{class:"mr-2"},{default:t(()=>[...e[15]||(e[15]=[o("mdi-shape",-1)])]),_:1}),e[18]||(e[18]=o(" Gift Types ",-1)),a(q),a(f,{color:"primary",onClick:e[0]||(e[0]=l=>O())},{default:t(()=>[a(g,{left:""},{default:t(()=>[...e[16]||(e[16]=[o("mdi-plus",-1)])]),_:1}),e[17]||(e[17]=o(" Add Type ",-1))]),_:1})]),_:1}),a(b,null,{default:t(()=>[a(Y,null,{default:t(()=>[(p(!0),S(P,null,z(n.value,l=>(p(),w(Z,{key:l.type_id,cols:"12",sm:"6",md:"4",lg:"3"},{default:t(()=>[a(V,null,{default:t(()=>[a(b,{class:"text-center"},{default:t(()=>[R("div",ve,s(l.type_name),1),R("div",ye,s(F(l.type_name))+" gifts ",1)]),_:2},1024),a(D,{class:"justify-center"},{default:t(()=>[a(f,{icon:"",size:"small",color:"primary",onClick:m=>O(l)},{default:t(()=>[a(g,null,{default:t(()=>[...e[19]||(e[19]=[o("mdi-pencil",-1)])]),_:1})]),_:1},8,["onClick"]),a(f,{icon:"",size:"small",color:"error",onClick:m=>W(l)},{default:t(()=>[a(g,null,{default:t(()=>[...e[20]||(e[20]=[o("mdi-delete",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),a(V,null,{default:t(()=>[a(oe,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=l=>d.value=l),"bg-color":"primary","show-arrows":""},{default:t(()=>[(p(!0),S(P,null,z(n.value,l=>(p(),w(ue,{key:l.type_id,value:l.type_name},{default:t(()=>[o(s(l.type_name)+" ("+s(F(l.type_name))+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a(G,{class:"d-flex align-center"},{default:t(()=>[a(g,{class:"mr-2"},{default:t(()=>[...e[21]||(e[21]=[o("mdi-gift",-1)])]),_:1}),o(" "+s(d.value)+" Gifts ",1),a(q),a(f,{color:"primary",onClick:e[2]||(e[2]=l=>X())},{default:t(()=>[a(g,{left:""},{default:t(()=>[...e[22]||(e[22]=[o("mdi-plus",-1)])]),_:1}),e[23]||(e[23]=o(" Add Gift ",-1))]),_:1})]),_:1}),a(b,null,{default:t(()=>[a(Y,null,{default:t(()=>[(p(!0),S(P,null,z(K.value,l=>(p(),w(Z,{key:l.gift_id,cols:"12",sm:"6",md:"4",lg:"3"},{default:t(()=>[a(V,null,{default:t(()=>[a(J,{src:l.image_url,height:"200",cover:""},{default:t(()=>[a(N,{color:l.is_available?"success":"error",class:"ma-2",size:"small"},{default:t(()=>[o(s(l.is_available?"Active":"Inactive"),1)]),_:2},1032,["color"])]),_:2},1032,["src"]),a(G,null,{default:t(()=>[o(s(l.gift_name),1)]),_:2},1024),a(te,null,{default:t(()=>[a(N,{size:"small",color:"primary",class:"mr-2"},{default:t(()=>[o(s(l.required_points)+" pts ",1)]),_:2},1024),a(N,{size:"small",color:"secondary"},{default:t(()=>[o(" Stock: "+s(l.available_stock),1)]),_:2},1024)]),_:2},1024),l.gift_description?(p(),w(b,{key:0},{default:t(()=>[o(s(l.gift_description),1)]),_:2},1024)):j("",!0),a(D,null,{default:t(()=>[a(f,{color:"primary",variant:"text",onClick:m=>X(l)},{default:t(()=>[a(g,{left:""},{default:t(()=>[...e[24]||(e[24]=[o("mdi-pencil",-1)])]),_:1}),e[25]||(e[25]=o(" Edit ",-1))]),_:1},8,["onClick"]),a(f,{color:"error",variant:"text",onClick:m=>ae(l)},{default:t(()=>[a(g,{left:""},{default:t(()=>[...e[26]||(e[26]=[o("mdi-delete",-1)])]),_:1}),e[27]||(e[27]=o(" Delete ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),a(H,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=l=>k.value=l),"max-width":"500px"},{default:t(()=>[a(V,null,{default:t(()=>[a(G,null,{default:t(()=>[o(s(U.value?"Edit Gift Type":"Create Gift Type"),1)]),_:1}),a(b,null,{default:t(()=>[a(A,{modelValue:_.value.type_name,"onUpdate:modelValue":e[3]||(e[3]=l=>_.value.type_name=l),label:"Type Name",required:""},null,8,["modelValue"])]),_:1}),a(D,null,{default:t(()=>[a(q),a(f,{onClick:e[4]||(e[4]=l=>k.value=!1)},{default:t(()=>[...e[28]||(e[28]=[o("Cancel",-1)])]),_:1}),a(f,{color:"primary",onClick:Q},{default:t(()=>[...e[29]||(e[29]=[o("Save",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(H,{modelValue:T.value,"onUpdate:modelValue":e[14]||(e[14]=l=>T.value=l),"max-width":"600px"},{default:t(()=>[a(V,null,{default:t(()=>[a(G,null,{default:t(()=>[o(s($.value?"Edit Gift":"Create Gift"),1)]),_:1}),a(b,null,{default:t(()=>[a(se,{ref:"form"},{default:t(()=>[a(A,{modelValue:u.value.gift_name,"onUpdate:modelValue":e[6]||(e[6]=l=>u.value.gift_name=l),label:"Gift Name",required:""},null,8,["modelValue"]),a(ne,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=l=>v.value=l),label:"Upload Gift Image",accept:"image/*","prepend-icon":"mdi-camera",onChange:h,disabled:c.value},null,8,["modelValue","disabled"]),x.value?(p(),w(V,{key:0,class:"mb-4"},{default:t(()=>[a(J,{src:x.value,"max-height":"200",contain:""},null,8,["src"])]),_:1})):j("",!0),c.value?(p(),w(re,{key:1,"model-value":E.value,color:"primary",height:"25",striped:""},{default:t(()=>[R("strong",null,s(Math.ceil(E.value))+"%",1)]),_:1},8,["model-value"])):j("",!0),a(de,{modelValue:u.value.reward_type,"onUpdate:modelValue":e[8]||(e[8]=l=>u.value.reward_type=l),items:n.value.map(l=>l.type_name),label:"Gift Type",required:""},null,8,["modelValue","items"]),a(ie,{modelValue:u.value.gift_description,"onUpdate:modelValue":e[9]||(e[9]=l=>u.value.gift_description=l),label:"Description",rows:"3"},null,8,["modelValue"]),a(A,{modelValue:u.value.required_points,"onUpdate:modelValue":e[10]||(e[10]=l=>u.value.required_points=l),modelModifiers:{number:!0},label:"Required Points",type:"number",required:""},null,8,["modelValue"]),a(A,{modelValue:u.value.available_stock,"onUpdate:modelValue":e[11]||(e[11]=l=>u.value.available_stock=l),modelModifiers:{number:!0},label:"Available Stock",type:"number",required:""},null,8,["modelValue"]),a(me,{modelValue:u.value.is_available,"onUpdate:modelValue":e[12]||(e[12]=l=>u.value.is_available=l),label:"Active",color:"success"},null,8,["modelValue"])]),_:1},512)]),_:1}),a(D,null,{default:t(()=>[a(q),a(f,{onClick:e[13]||(e[13]=l=>T.value=!1),disabled:c.value},{default:t(()=>[...e[30]||(e[30]=[o("Cancel",-1)])]),_:1},8,["disabled"]),a(f,{color:"primary",onClick:le,loading:c.value},{default:t(()=>[...e[31]||(e[31]=[o("Save",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ee as default};
